# 2972. ç»Ÿè®¡ç§»é™¤é€’å¢å­æ•°ç»„çš„æ•°ç›® II

URL: https://leetcode.cn/problems/count-the-number-of-incremovable-subarrays-ii/
Difficulty: Difficult
Notes: åŒæŒ‡é’ˆï¼Œç¡®å®šé€’å¢çš„å‰ç¼€å’Œé€’å¢çš„åç¼€ï¼Œè‡ªå·±åšå‡ºæ¥çš„ï¼Œå‰è…°ğŸ®
Tag: åŒæŒ‡é’ˆ, æ»‘åŠ¨çª—å£
Best Times/Space: O(n),O(1)
Last edited time: July 10, 2024 5:09 PM
Score: 2153

## 2972. ç»Ÿè®¡ç§»é™¤é€’å¢å­æ•°ç»„çš„æ•°ç›® II

![Untitled](image/2972%20%E7%BB%9F%E8%AE%A1%E7%A7%BB%E9%99%A4%E9%80%92%E5%A2%9E%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE%20II/Untitled.png)

### æ€è·¯

ç¡®å®šå‰ç¼€é€’å¢å’Œåç¼€é€’å¢çš„èŒƒå›´ï¼Œleftå’Œrightåˆ†åˆ«åœ¨å‰ç¼€å’Œåç¼€ä¸­æ»‘åŠ¨ï¼Œæ³¨æ„åŒºé—´çš„å¼€é—­å’Œleftä¸rightçš„ä¸Šé™ã€‚

PSï¼šä»£ç æ€è·¯å¦‚æœå¿˜äº†å¯ä»¥çœ‹ä¸€ä¸‹æ›¾ç»çš„æäº¤è®°å½•ï¼Œé€æ­¥ä¼˜åŒ–è¿‡æ¥çš„ã€‚

### åŒæŒ‡é’ˆ

```java
class Solution {
    public long incremovableSubarrayCount(int[] nums) {
        int n = nums.length;

        // å…ˆçœ‹åç¼€é€’å¢çš„é•¿åº¦ï¼Œç§»é™¤é€’å¢å­æ•°ç»„çš„ç»“å°¾æœ€å°è¦æ˜¯end-1
        // [end,n)ï¼Œéƒ½æ˜¯é€’å¢çš„
        int end = n - 1;
        while (end > 0 && nums[end] > nums[end - 1]) {
            end--;
        }

        // æ•´ä¸ªéƒ½æ˜¯é€’å¢çš„ï¼Œç›´æ¥è¿”å›
        if (end == 0) {
            return ((long) n * (n + 1)) / 2;
        }
        
        // [0, start)ï¼Œéƒ½æ˜¯é€’å¢çš„
        int start = 1;
        while (start < n && nums[start] > nums[start - 1]) {
            start++;
        }
        
        long ans = 0;
        int left = 0, right = end, pre = 0;
        // [left,right)æ˜¯ç§»é™¤é€’å¢å­æ•°ç»„ï¼Œç”±äºrightåŠå…¶ä¹‹åæ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥[left,right+1...n)ä¹Ÿéƒ½æ˜¯ç§»é™¤é€’å¢å­æ•°ç»„ï¼Œé•¿åº¦æ˜¯n - (right - 1)
        // ç”±äºæ˜¯å¼€åŒºé—´ï¼Œæ‰€ä»¥rightå¯ä»¥ç­‰äºn
        // åˆ¤æ–­[0,left)æ˜¯ä¸æ˜¯é€’å¢çš„
        // rightåˆ°nä¹‹åå°±ä¸åŠ¨äº†ï¼Œå¯ä»¥ä¸ç”¨åœ¨whileåˆ¤æ–­
        while (left <= start) {
            while (right < n && nums[right] <= pre) {
                right++;
            }
            ans += n - right + 1;
            pre = nums[left++];
        }
        return ans;
    }
}
```